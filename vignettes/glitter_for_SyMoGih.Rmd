---
title: "glitter for SyMoGIH"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{glitter for SyMoGIH}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = TRUE, message=FALSE, warning=FALSE
)
```

```{r setup}
library(glitter)
```

## Rechercher toutes les informations impliquant l'objet "Mathématiques" (Objet abstrait):

- la ressource r est associée à l'objet "Mathématiques" (syr: Ab0b213)
- la ressource r est une partie de i
- i a une étiquette standard stLabel
  + et une date standard stDate
  + et un type KUTy
- KUTy a pour étiquette KUTyLabel

```{r ressources_maths}
tib = spq_init() %>%
  spq_prefix(prefixes=c(sym="http://symogih.org/ontology/",
                        syr="http://symogih.org/resource/")) %>% 
  spq_set(mathematiques = "syr:AbOb213") %>%
  spq_filter(r == sym::associatesObject(mathematiques)) %>% 
  spq_filter(r == sym::isComponentOf(i)) %>% 
  spq_mutate(stLabel = sym::knowledgeUnitStandardLabel(i)) %>% 
  spq_mutate(stDate = sym::knowledgeUnitStandardDate(i)) %>% 
  spq_mutate(KUTy = sym::hasKnowledgeUnitType(i)) %>% 
  spq_mutate(KUTyLabel = rdfs::label(KUTy)) %>% 
  spq_head(n = 10) %>% 
  spq_perform(endpoint="http://bhp-publi.ish-lyon.cnrs.fr:8888/sparql")
  
knitr::kable(tib)
```

## Structure de la partie abstraite de l'ontologie

```{r}
tib=spq_init() %>%
  spq_prefix(prefixes=c(sym="http://symogih.org/ontology/",
                        syr="http://symogih.org/resource/")) %>%  
  spq_add(.triple_pattern = "?s a ?cl") %>% 
  spq_add(.triple_pattern ="?s ?p ?o1") %>% 
  spq_add(.triple_pattern ="?o1 a ?cl1", required=FALSE) %>% 
  spq_group_by(cl, p, cl1) %>% 
  spq_head(n=10) %>% 
  spq_summarise(effectif = n("*")) %>% 
  spq_arrange(desc(effectif)) %>% 
  spq_perform(endpoint="http://bhp-publi.ish-lyon.cnrs.fr:8888/sparql")

knitr::kable(tib)
```

## Structure de la partie instanciée de l'ontologie

```{r}
tib=spq_init() %>%
  spq_prefix(prefixes=c(sym="http://symogih.org/ontology/",
                        syr="http://symogih.org/resource/")) %>% 
  spq_add(.triple_pattern ="?s sym:hasKnowledgeUnitType ?tyin") %>% 
  spq_add(.triple_pattern ="?r sym:isComponentOf ?s") %>% 
  spq_add(.triple_pattern ="?r sym:hasRoleType ?tyro") %>% 
  spq_group_by(tyin, tyro) %>% 
  spq_summarise(effectif = n("*")) %>% 
  spq_arrange(tyin,tyro,desc(effectif)) %>% 
  spq_head(n=10) %>% 
  spq_perform(endpoint="http://bhp-publi.ish-lyon.cnrs.fr:8888/sparql")
```

## Types d'informations et types de rôles, avec effectifs


```{r}
tib=spq_init() %>% 
  spq_prefix(prefixes=c(sym="http://symogih.org/ontology/",
                        syr="http://symogih.org/resource/")) %>% 
  spq_add(.triple_pattern ="?s sym:hasKnowledgeUnitType ?tyin") %>% 
  spq_add(.triple_pattern ="?r sym:isComponentOf ?s") %>% 
  spq_add(.triple_pattern ="?r sym:hasRoleType ?tyro") %>% 
  spq_group_by(tyin, tyro) %>% 
  spq_summarise(effectif = n("*")) %>% 
  spq_arrange(tyin, tyro, effectif) %>% 
  spq_head(n=10) %>%
  spq_perform(endpoint="http://bhp-publi.ish-lyon.cnrs.fr:8888/sparql")

knitr::kable(tib)
```

## Le parcours biographique de Gaston,Louis, Henry May (1849 - 1940)

```{r}
tib=spq_init() %>% 
  spq_prefix(prefixes=c(sym="http://symogih.org/ontology/",
                        syr="http://symogih.org/resource/")) %>% 
  spq_add(.triple_pattern ="?tyro rdfs:label ?TyRoLabel") %>% 
  spq_add(.triple_pattern ="?tyin rdfs:label ?TyInLabel") %>% 
  spq_add(.triple_pattern ="?s ?p syr:Actr56241") %>% 
  spq_add(.triple_pattern =". sym:isComponentOf ?info") %>% 
  spq_add(.triple_pattern =". sym:hasRoleType ?tyro") %>% 
  spq_add(.triple_pattern ="?info sym:knowledgeUnitStandardLabel ?infoStandardLabel") %>% 
  spq_add(.triple_pattern =". sym:knowledgeUnitStandardDate ?infoStandardDate") %>% 
  spq_add(.triple_pattern =". sym:hasKnowledgeUnitType ?tyin") %>% 
  spq_arrange(infoStandardDate) %>% 
  spq_head(n=10) %>% 
  spq_perform(endpoint="http://bhp-publi.ish-lyon.cnrs.fr:8888/sparql")

knitr::kable(tib)
```
