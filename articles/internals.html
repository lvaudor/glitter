<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="glitter">
<title>glitter design and internals • glitter</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="glitter design and internals">
<meta property="og:description" content="glitter">
<meta property="og:image" content="https://lvaudor.github.io/glitter/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">glitter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.999</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/glitter_for_Wikidata.html">Get started with Wikidata</a>
    <a class="dropdown-item" href="../articles/explore.html">Explore a new database</a>
    <a class="dropdown-item" href="../articles/glitter_for_hal.html">glitter for dataBNF</a>
    <a class="dropdown-item" href="../articles/glitter_for_hal.html">Bibliometry with HAL</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lvaudor/glitter/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>glitter design and internals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lvaudor/glitter/blob/HEAD/vignettes/articles/internals.Rmd" class="external-link"><code>vignettes/articles/internals.Rmd</code></a></small>
      <div class="d-none name"><code>internals.Rmd</code></div>
    </div>

    
    
<p>This article describes how glitter works, and why. At this stage of
glitter history, feedback and feature requests are most welcome!</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lvaudor.github.io/glitter/">glitter</a></span><span class="op">)</span></span></code></pre></div>
<p>The glitter package helps writing SPARQL queries by implementing an
internal <em>domain-specific language</em>: with glitter, you write code
that mostly looks like R code, and end up with a SPARQL query. For
instance:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://lvaudor.github.io/glitter/">"glitter"</a></span><span class="op">)</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spq_init.html">spq_init</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_add.html">spq_add</a></span><span class="op">(</span><span class="st">"?item wdt:P31 wd:Q13442814"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_add.html">spq_add</a></span><span class="op">(</span><span class="st">"?item rdfs:label ?itemTitle"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_filter.html">spq_filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="fu">str_to_lower</span><span class="op">(</span><span class="va">itemTitle</span><span class="op">)</span>, <span class="st">'wikidata'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_filter.html">spq_filter</a></span><span class="op">(</span><span class="fu">lang</span><span class="op">(</span><span class="va">itemTitle</span><span class="op">)</span> <span class="op">==</span> <span class="st">"en"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_head.html">spq_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">query</span></span>
<span><span class="co">#&gt; <span style="color: #008700; font-weight: bold;">PREFIX</span> rdfs: <span style="color: #AF00FF; font-style: italic;">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #008700; font-weight: bold;">SELECT</span> <span style="color: #000087;">?item</span> <span style="color: #000087;">?itemTitle</span></span></span>
<span><span class="co">#&gt; <span style="color: #008700; font-weight: bold;">WHERE</span> {</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #000087;">?item</span> <span style="color: #0000D7; font-weight: bold;">wdt</span>:<span style="color: #008700; font-weight: bold;">P31</span> <span style="color: #0000D7; font-weight: bold;">wd</span>:<span style="color: #008700; font-weight: bold;">Q13442814</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #000087;">?item</span> <span style="color: #0000D7; font-weight: bold;">rdfs</span>:<span style="color: #008700; font-weight: bold;">label</span> <span style="color: #000087;">?itemTitle</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #008700; font-weight: bold;">FILTER</span>(<span style="color: #008700; font-weight: bold;">REGEX</span>(<span style="color: #008700; font-weight: bold;">LCASE</span>(<span style="color: #000087;">?itemTitle</span>),<span style="color: #AF0000;">"wikidata"</span>))</span></span>
<span><span class="co">#&gt; <span style="color: #008700; font-weight: bold;">FILTER</span>(lang(<span style="color: #000087;">?itemTitle</span>)=<span style="color: #AF0000;">"en"</span>)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #008700; font-weight: bold;">LIMIT</span> 5</span></span></code></pre></div>
<p>The R code should therefore be easier to write, and read. The
function names and syntax are meant to remind of the tidyverse, and of
base R.</p>
<p>Code using glitter will feature:</p>
<ul>
<li>a call to <code><a href="../reference/spq_init.html">spq_init()</a></code>;</li>
<li>most often, calls to <code><a href="../reference/spq_add.html">spq_add()</a></code> to add SPARQL triple
patterns to the query;</li>
<li>potentially, calls to <code><a href="../reference/spq_set.html">spq_set()</a></code> to define helper values
like
<code>spq_set(species = c('wd:Q144','wd:Q146', 'wd:Q780'), mayorcode = "wd:Q30185")</code>;</li>
<li>potentially, calls to <code><a href="../reference/spq_filter.html">spq_filter()</a></code>,
<code><a href="../reference/spq_select.html">spq_select()</a></code> to filter results;</li>
<li>potentially, calls to <code><a href="../reference/spq_arrange.html">spq_arrange()</a></code>,
<code><a href="../reference/spq_head.html">spq_head()</a></code>, <code><a href="../reference/spq_offset.html">spq_offset()</a></code> to order and trim
results;</li>
<li>lastly a call to <code><a href="../reference/spq_perform.html">spq_perform()</a></code> to send the query and
return the results.</li>
</ul>
<div class="section level2">
<h2 id="glitter-query-object">glitter query object<a class="anchor" aria-label="anchor" href="#glitter-query-object"></a>
</h2>
<p>The query object is a list with elements such as the variables
(vars), filters, etc. Later we might make it an actual class, maybe an
R6 one?</p>
<p>It is built by the different calls to <code>spq_</code> functions.
The SPARQL query string is assembled by <code><a href="../reference/spq_assemble.html">spq_assemble()</a></code>.
Later we might add some linting at that stage.</p>
</div>
<div class="section level2">
<h2 id="glitter-tooling">glitter tooling<a class="anchor" aria-label="anchor" href="#glitter-tooling"></a>
</h2>
<p>Under the hood, glitter uses</p>
<ul>
<li>the <a href="https://rlang.r-lib.org/" class="external-link">rlang package by Lionel Henry
and Hadley Wickham</a> to encapsulate <code>...</code> arguments into
quosures before handling them. Useful references were <a href="https://adv-r.hadley.nz/metaprogramming.html" class="external-link">the Metaprogramming
section of the Advanced R book by Hadley Wickham</a> as well as the
documentation of the <a href="https://rlang.r-lib.org/" class="external-link">rlang
package</a>.</li>
<li>the <a href="https://r-lib.github.io/xmlparsedata/" class="external-link">xmlparsedata
package by Gábor Csárdi</a> to parse the R looking code, and the <a href="https://xml2.r-lib.org/" class="external-link">xml2 package by Hadley Wickham, Jim
Hester and Jeroen Ooms</a>, to transform that code into SPARQL code with
XPath. Useful references were the documentation of these two packages as
well as searching for XPath query examples via a search engine.</li>
<li>the <a href="https://httr2.r-lib.org/" class="external-link">httr2 package by Hadley
Wickham</a> package to perform queries. We learnt sending such queries
thanks to the source code of the <a href="https://github.com/wikimedia/WikidataQueryServiceR" class="external-link">WikidataQueryServiceR
package</a> by Mikhail Popov.</li>
</ul>
<p>More details in the next sections.</p>
</div>
<div class="section level2">
<h2 id="spq_add">spq_add()<a class="anchor" aria-label="anchor" href="#spq_add"></a>
</h2>
<p><code><a href="../reference/spq_add.html">spq_add()</a></code> works differently from the other
<code>spq_</code> functions because it looks closer to SPARQL.</p>
<p>Clearly something like
<code>spq_add(query, "?item wdt:P31 wd:Q13442814")</code> does not look
like R code. The motivation for this is:</p>
<ul>
<li>easier copy-pasting from SPARQL query examples;</li>
<li>the ability to keep the SPARQL concepts.</li>
</ul>
<p>Triple patterns are parsed by <code>decompose_triples</code> that
uses string manipulation.</p>
<p>Now, if one wants to go full DSL, it is possible, via
<code><a href="../reference/spq_filter.html">spq_filter()</a></code> and <code><a href="../reference/spq_mutate.html">spq_mutate()</a></code>.</p>
<p>The triple pattern in
<code>spq_add(query, "?item wdt:P31 wd:Q13442814")</code> means finding
items that are an instance of (“wdt:P31”) of a scholarly article
(“wd:Q13442814”). With glitter, you can also write it</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spq_init.html">spq_init</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_filter.html">spq_filter</a></span><span class="op">(</span><span class="va">item</span> <span class="op">==</span> <span class="fu">wdt</span><span class="fu">::</span><span class="fu">P31</span><span class="op">(</span><span class="fu">wd</span><span class="fu">::</span><span class="va">Q13442814</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This looks more like a normal tidyverse pipeline. Note that the
namespacing here is done the R way i.e. <code>wdt::P31</code> as opposed
to “wdt:P31”.</p>
<p>Similary,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spq_init.html">spq_init</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_add.html">spq_add</a></span><span class="op">(</span><span class="st">"wd:Q331676 wdt:P1843 ?statement"</span><span class="op">)</span></span></code></pre></div>
<p>adds a variable that is “wdt:P1843” of Sonchus oleraceus
(“wd:Q331676”). It can be written:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spq_init.html">spq_init</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_mutate.html">spq_mutate</a></span><span class="op">(</span>statement <span class="op">=</span> <span class="fu">wdt</span><span class="fu">::</span><span class="fu">P1843</span><span class="op">(</span><span class="fu">wd</span><span class="fu">::</span><span class="va">Q331676</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-spq_-functions">Other <code>spq_</code> functions<a class="anchor" aria-label="anchor" href="#other-spq_-functions"></a>
</h2>
<p>The other <code>spq_</code> functions <code><a href="../reference/spq_arrange.html">spq_arrange()</a></code>,
<code><a href="../reference/spq_select.html">spq_select()</a></code>, <code><a href="../reference/spq_mutate.html">spq_mutate()</a></code>,
<code><a href="../reference/spq_mutate.html">spq_mutate()</a></code> , <code><a href="../reference/spq_filter.html">spq_filter()</a></code>,
<code><a href="../reference/spq_summarise.html">spq_summarize()</a></code> are the core of the DSL.</p>
<p>They have <code>...</code> as arguments where three different things
can be passed:</p>
<ul>
<li>R-looking snippets (the DSL), for instance
<code>spq_filter(query, lang(itemTitle) == "en")</code>;</li>
<li>R-looking snippets as string (for programmatic use), for instance
<code>spq_filter(query, 'lang(itemTitle) == "en"')</code>;</li>
<li>SPARQL snippets escaped with <code><a href="../reference/spq.html">spq()</a></code> (for copy-pasting
from SPARQL examples), for instance
<code>spq_filter(query, spq('lang(?itemTitle)="en"'))</code>.</li>
</ul>
<p>The names of their other arguments starts with a dot to prevent name
clashes.</p>
<p>How do we differentiate these three things that users can pass?</p>
<ul>
<li>First, arguments are transformed into quosures with
<code>rlang::enquos(...)</code>.</li>
<li>Each of them is passed to a function like
<code>spq_treat_argument()</code>. “Like” as the more complex behavior
of <code><a href="../reference/spq_filter.html">spq_filter()</a></code> and <code><a href="../reference/spq_mutate.html">spq_mutate()</a></code>, that can
accept R-looking snippets that will be translated to either triple
patterns or not, warrants a bit more logic.</li>
<li>In <code>spq_treat_argument()</code> we try evaluating the argument
via <code><a href="https://rlang.r-lib.org/reference/eval_tidy.html" class="external-link">rlang::eval_tidy()</a></code>.
<ul>
<li>If the result is of the class <code>spq</code>, then it means we can
use the string as is, it was SPARQL.</li>
<li>If the result is another character, it is the code to be translated
(example: <code>'lang(itemTitle) == "en"'</code>).</li>
<li>If it is not, we need to get the text of the expression via
<code>rlang::expr_text(arg) %&gt;% stringr::str_replace("^~", "")</code>
(example: the user wrote <code>lang(itemTitle) == "en"</code>).</li>
</ul>
</li>
<li>In the two latter cases, we have R-looking code to translate into a
SPARQL snippet. We first parse the code with xmlparsedata and xml2. Then
a series of transformations supported by XPath happen. The glitter
package contains a <code>tibble</code> called
<code>all_correspondences</code>:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">glitter</span><span class="fu">::</span><span class="va"><a href="../reference/sparql-dsl.html">all_correspondences</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   R      SPARQL args      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> n      COUNT  <span style="color: #949494;">&lt;list [0]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> sum    SUM    <span style="color: #949494;">&lt;list [0]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> mean   AVG    <span style="color: #949494;">&lt;list [0]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> min    MIN    <span style="color: #949494;">&lt;list [0]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> max    MAX    <span style="color: #949494;">&lt;list [0]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> sample SAMPLE <span style="color: #949494;">&lt;list [0]&gt;</span></span></span></code></pre></div>
<p>So all instances of <code>n(blabla)</code> become
<code>COUNT(blabla)</code>. We also transform argument names. Look at
the “SELECT” statement below, the <code>str_c()</code> function becomes
<code>GROUP_CONCAT()</code> and its argument <code>SEPARATOR</code>.
Also note that the argument comes after a colon, not a comma like in
R.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spq_init.html">spq_init</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_summarise.html">spq_summarise</a></span><span class="op">(</span>authors <span class="op">=</span> <span class="fu">str_c</span><span class="op">(</span><span class="va">name</span>, sep <span class="op">=</span> <span class="st">', '</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Later, we need to document these correspondences better, and we need
to stress test the DSL with more cases using arguments.</p>
<div class="section level4">
<h4 id="special-case-of-spq_filter-and-spq_mutate">Special case of <code>spq_filter()</code> and
<code>spq_mutate()</code><a class="anchor" aria-label="anchor" href="#special-case-of-spq_filter-and-spq_mutate"></a>
</h4>
<p><code><a href="../reference/spq_filter.html">spq_filter()</a></code> receives R-looking fragments that are
translated into SPARQL snippets for FILTER… or triple patterns.
<code><a href="../reference/spq_mutate.html">spq_mutate()</a></code> receives R-looking fragments that are
translated into SPARQL snippets for SELECT… or triple patterns.</p>
<p>At the moment the detection of which is which is based on
<code>::</code>: if the R-looking fragment contains <code>::</code>, we
assume it will become a triple pattern. Later, we need to make this more
robust as the function <code><a href="../reference/spq_set.html">spq_set()</a></code> makes it easier to create
synonyms for any subject/verb/object via SPARQL VALUES.</p>
<p>When we assume <code><a href="../reference/spq_filter.html">spq_filter()</a></code>/<code><a href="../reference/spq_mutate.html">spq_mutate()</a></code>
has received an R-looking fragment meant to be translated to a triple
pattern, it is parsed so, not forgetting the order is not the same in
the two cases:</p>
<ul>
<li>
<code>spq_mutate(object = verb(subject))</code>;</li>
<li>
<code>spq_filter(subject == verb(object))</code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="r-cmd-check-hack">R CMD check hack<a class="anchor" aria-label="anchor" href="#r-cmd-check-hack"></a>
</h2>
<p>The examples using something like</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spq_init.html">spq_init</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/spq_filter.html">spq_filter</a></span><span class="op">(</span><span class="va">item</span> <span class="op">==</span> <span class="fu">wdt</span><span class="fu">::</span><span class="fu">P31</span><span class="op">(</span><span class="fu">wd</span><span class="fu">::</span><span class="va">Q13442814</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>got flagged as if wdt were a dependency to be stated. This is
understandable. To bypass it these examples are not examples, they are R
chunks in a section called “Some examples”. This means they aren’t
checked. Thankfully we have similar code in the real tests!</p>
</div>
<div class="section level2">
<h2 id="future-work">Future work<a class="anchor" aria-label="anchor" href="#future-work"></a>
</h2>
<p>The issue tracker of glitter is quite representative of future work,
as well as all sentences starting with “Later” in this article. As
stated at the very beginning of this article, your ideas and comments
are welcome.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://perso.ens-lyon.fr/lise.vaudor/" class="external-link">Lise Vaudor</a>, Maëlle Salmon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
